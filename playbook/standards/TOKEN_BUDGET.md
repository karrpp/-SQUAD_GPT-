# Token Budget Protocol

> 모든 프로젝트에 적용되는 Claude API 토큰 예산 규칙.
> 결정: 2026-02-10 | 수립: @Guardiola

---

## 1. 기본 모델: Sonnet

- Claude Code 시작 시 **Sonnet**을 기본 모델로 사용
- 일반 대화, 코딩, 디버깅, 파일 수정 = Sonnet
- Opus는 명시적 소환(`@Guardiola`) 또는 아래 조건 충족 시에만 사용

## 2. 모델 티어링 매트릭스

| 티어 | 작업 유형 | 모델 | 요청당 단가 | 비율 목표 |
|------|-----------|------|------------|----------|
| **T0** | 아키텍처 설계, 전략 수립, 위기 중재 | Opus | ~$0.125 | 10-15% |
| **T1** | 코드 리뷰, 기능 설계, 디버깅, 아이디어 | Sonnet | ~$0.025 | 40-50% |
| **T2** | 코드 작성, 리팩토링, 테스트, 파일 수정 | Sonnet | ~$0.025 | 30-35% |
| **T3** | 포맷 변환, 단순 분류, 정리, 번역 | Haiku | ~$0.007 | 10-15% |

## 3. Opus 사용 조건 — 3가지 중 1개 이상

1. **복수 에이전트 종합** — 여러 에이전트 의견을 종합하는 전략적 판단
2. **아키텍처 결정** — 되돌리기 비용이 높은 설계 결정
3. **위기 상황** — 중대 버그, 방향 충돌, 기술 부채 청산

이 3가지에 해당하지 않으면 Opus를 사용하지 않는다.

## 4. 에이전트-모델 매핑

| 에이전트 | 모델 | 비고 |
|----------|------|------|
| Guardiola | Opus | 전략 종합은 최고 추론 필요. 소환 시에만 |
| Messi | Opus | 캡틴은 항상 최고 추론. 방향 설정 + 위기 중재 |
| CR7 | Sonnet | 아이디어 + 실행 |
| Modric | Sonnet | 태스크 변환 |
| Buffon | Sonnet (기본) / Haiku (경량 검증) | 로직 검증 = Sonnet, 린트/타입 = Haiku |
| Pedri | Haiku | 루틴 업무 |

## 5. 모델 승격 프로토콜

```
시작: Haiku → 복잡도 부족 → Sonnet → 전략 판단 필요 → Opus
```

항상 낮은 티어에서 시작, 필요할 때만 올린다.

## 6. 경기 유형별 모델 배분

| 경기 유형 | 워크플로우 | 모델 배분 |
|-----------|-----------|-----------|
| 빠른 카운터 | Modric → Buffon | Sonnet → Sonnet |
| 세트피스 | Buffon만 | Sonnet |
| 풀 경기 | 7단계 전체 | Opus(Guardiola만) + Sonnet(나머지) + Haiku(루틴) |

## 7. 비용 가이드라인

| 구분 | 일일 | 월간 |
|------|------|------|
| 목표 | $7-10 | $200-300 |
| Opus 비율 | 전체 요청의 15% 이하 | — |

## 8. 캐시 규칙

- CLAUDE.md는 50줄 이내 유지
- 20회 이상 대화 시 새 세션 권장
- 독립 작업은 별도 세션 분리
- 동일 구조 요청은 동일 프롬프트 패턴 → Cache Read 극대화
